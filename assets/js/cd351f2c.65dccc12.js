"use strict";(self.webpackChunktest=self.webpackChunktest||[]).push([[171],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>g});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),m=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=m(e.components);return r.createElement(l.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=m(n),c=a,g=d["".concat(l,".").concat(c)]||d[c]||u[c]||i;return n?r.createElement(g,o(o({ref:t},p),{},{components:n})):r.createElement(g,o({ref:t},p))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:a,o[1]=s;for(var m=2;m<i;m++)o[m]=n[m];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},293:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>m});var r=n(7462),a=(n(7294),n(3905));const i={sidebar_position:7},o=void 0,s={unversionedId:"reference/Multithreading",id:"reference/Multithreading",title:"Multithreading",description:"BagelECS provides a simple way to add multithreading to your application through JS worker threads. Most things should be seamless, but there are a few important limitations that you should know about.",source:"@site/docs/reference/Multithreading.md",sourceDirName:"reference",slug:"/reference/Multithreading",permalink:"/BagelECS/docs/reference/Multithreading",draft:!1,editUrl:"https://github.com/Bagel03/BagelECS/edit/master/docs/docs/reference/Multithreading.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"tutorialSidebar",previous:{title:"Systems",permalink:"/BagelECS/docs/reference/Systems"},next:{title:"Relationships",permalink:"/BagelECS/docs/reference/Relationships"}},l={},m=[{value:"System Multithreading",id:"system-multithreading",level:2},{value:"Updating",id:"updating",level:2},{value:"SIMD Multithreading",id:"simd-multithreading",level:2},{value:"Limitations",id:"limitations",level:2},{value:"Resources",id:"resources",level:3},{value:"<code>Any</code> Component Types",id:"any-component-types",level:3},{value:"Adding and Removing Entities and Components",id:"adding-and-removing-entities-and-components",level:3}],p={toc:m},d="wrapper";function u(e){let{components:t,...n}=e;return(0,a.kt)(d,(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"BagelECS provides a simple way to add multithreading to your application through JS ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers"},"worker threads"),". Most things should be seamless, but there are a few important limitations that you should know about."),(0,a.kt)("h2",{id:"system-multithreading"},"System Multithreading"),(0,a.kt)("p",null,"System multithreading refers to running a whole system on its own thread. It's queries will still be based on the main thread, but the logic will not interrupt anything on it's origin thread. Telling BagelECS to run a system on its own thread takes 2 steps:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"First, create your system in a separate file, and register it as a remote system:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="system.ts"',title:'"system.ts"'},'import { System } from "bagelecs";\nimport { registerRemoteSystem } from "bagelecs/remote";\n\nimport { Pos } from "./components/position";\n\nexport class MySystem extends System(Pos) {\n    update() {\n        // Move all entities to the right\n        this.entities.forEach((ent) =>\n            ent.update(Pos.x, ent.get(Pos.x) + 1)\n        );\n    }\n}\n\n// Use this:\nregisterRemoteSystem(MySystem);\n')),(0,a.kt)("admonition",{parentName:"li",type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"Notice that ",(0,a.kt)("inlineCode",{parentName:"p"},"registerRemoteSystem")," is imported from ",(0,a.kt)("inlineCode",{parentName:"p"},"bagelecs/remote"),", not from the base ",(0,a.kt)("inlineCode",{parentName:"p"},"bagelecs")," pacakge."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Now use ",(0,a.kt)("inlineCode",{parentName:"p"},"World.prototype.addRemoteSystem")," and pass in the path to your system file:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="main.ts"',title:'"main.ts"'},'const world = new World(100);\n\nworld.addRemoteSystem("./system.ts");\n')),(0,a.kt)("admonition",{parentName:"li",type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"Make sure that the server you are using can give bagelecs a full path to your system file. This is the source of almost all issues with starting a remote system,\nas in many environments bagelecs will look for ",(0,a.kt)("inlineCode",{parentName:"p"},"./system.ts")," inside of ",(0,a.kt)("inlineCode",{parentName:"p"},"node_modules/bagelecs"),", which will of course fail.")),(0,a.kt)("p",{parentName:"li"},"You should see a message in the console verifying that your system is working."))),(0,a.kt)("h2",{id:"updating"},"Updating"),(0,a.kt)("p",null,"Remote systems are updated just like any other system, either all at once ",(0,a.kt)("inlineCode",{parentName:"p"},"world.update()")," or by passing the system into the ",(0,a.kt)("inlineCode",{parentName:"p"},"update()")," method:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'import { MySystem } from "./system";\n\nworld.update(MySystem);\n')),(0,a.kt)("h2",{id:"simd-multithreading"},"SIMD Multithreading"),(0,a.kt)("p",null,"SIMD (",(0,a.kt)("em",{parentName:"p"},"single instruction multiple data"),") refers to running ths same instruction (function) over lots of data (in an ECS's case different entities and their components).\nThis would mean running a single system in multiple threads, and evenly distributing the system's targeted entities among the threads. ",(0,a.kt)("strong",{parentName:"p"},"Currently, BagelECS does not support running the same system in multiple threads"),", however it is being investigated."),(0,a.kt)("h2",{id:"limitations"},"Limitations"),(0,a.kt)("p",null,"Due to the nature of worker threads, there are quite a few things that bagelECS can not (realistically) do, including:"),(0,a.kt)("h3",{id:"resources"},"Resources"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"/BagelECS/docs/reference/Resources"},"Resources")," are not automatically synced between threads. This is because diffing all of your resources every frame would be too expensive and would most likely be slower than having no multithreading at all."),(0,a.kt)("h3",{id:"any-component-types"},(0,a.kt)("inlineCode",{parentName:"h3"},"Any")," Component Types"),(0,a.kt)("p",null,"Similar to resources, any component property that is of type ",(0,a.kt)("inlineCode",{parentName:"p"},"Type.any")," is not automatically synced. ",(0,a.kt)("a",{parentName:"p",href:"/BagelECS/docs/reference/Components#external-components"},"External components")," (Not made with ",(0,a.kt)("inlineCode",{parentName:"p"},"Component()"),"), as well as ",(0,a.kt)("inlineCode",{parentName:"p"},"Type.string")," are also not synced."),(0,a.kt)("h3",{id:"adding-and-removing-entities-and-components"},"Adding and Removing Entities and Components"),(0,a.kt)("p",null,"Currently, worker systems can only edit data that already exists. BagelECS does not allow adding or removing entities from a world, or adding or removing components from an entity."))}u.isMDXComponent=!0}}]);